<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>StudyPro Academy | Admin</title>
  <style>
    body{margin:0;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif;background:#f4f7fb;color:#142033}
    .container{width:min(1120px,92%);margin:0 auto}.nav{background:#fff;border-bottom:1px solid #e4ebf5}
    .nav .inner{min-height:64px;display:flex;align-items:center;justify-content:space-between}
    .links a{text-decoration:none;color:#1e2c41;margin-left:12px;font-weight:600}
    .card{background:#fff;border:1px solid #e4ebf5;border-radius:16px;padding:18px;box-shadow:0 14px 28px rgba(15,31,58,.08);margin:16px 0}
    table{width:100%;border-collapse:collapse}th,td{padding:10px;border-bottom:1px solid #e4ebf5;text-align:left}
    .muted{color:#5d6b82}
  </style>
</head>
<body>
  <div class="nav"><div class="container inner"><strong>StudyPro Admin</strong><div class="links"><a href="/dashboard.html">Dashboard</a><a href="#" id="logoutBtn">Logout</a></div></div></div>
  <div class="container">
    <div class="card"><h2 style="margin:0 0 8px;">Admin Overview</h2><p id="stats" class="muted">Loading...</p></div>
    <div class="card"><h3>Users</h3><table><thead><tr><th>ID</th><th>Name</th><th>Email</th><th>Role</th><th>Created</th></tr></thead><tbody id="usersBody"></tbody></table></div>
    <div class="card"><h3>Payments</h3><table><thead><tr><th>ID</th><th>User</th><th>Email</th><th>Plan</th><th>Amount</th><th>Ref</th><th>Status</th><th>Paid At</th></tr></thead><tbody id="paymentsBody"></tbody></table></div>
  </div>
  <script src="/assets/app.js"></script>
  <script>
    const stats = document.getElementById("stats");
    const usersBody = document.getElementById("usersBody");
    const paymentsBody = document.getElementById("paymentsBody");

    async function init() {
      try {
        const me = await studypro.api("/api/auth/me");
        if (me.user.role !== "admin") return window.location.href = "/dashboard.html";
        const ov = await studypro.api("/api/admin/overview");
        stats.textContent = `Users: ${ov.stats.users} | Payments: ${ov.stats.payments} | Revenue: Rs ${ov.stats.revenue} | Active Subs: ${ov.stats.activeSubscriptions}`;
        const users = await studypro.api("/api/admin/users");
        users.rows.forEach((u) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${u.id}</td><td>${u.name}</td><td>${u.email}</td><td>${u.role}</td><td>${new Date(u.created_at).toLocaleString()}</td>`;
          usersBody.appendChild(tr);
        });
        const payments = await studypro.api("/api/admin/payments");
        payments.rows.forEach((p) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${p.id}</td><td>${p.name}</td><td>${p.email}</td><td>${p.plan_key}</td><td>Rs ${p.amount}</td><td>${p.payment_ref}</td><td>${p.status}</td><td>${new Date(p.paid_at).toLocaleString()}</td>`;
          paymentsBody.appendChild(tr);
        });
      } catch (_) {
        window.location.href = "/login.html";
      }
    }

    document.getElementById("logoutBtn").addEventListener("click", async (e) => {
      e.preventDefault();
      await studypro.api("/api/auth/logout", { method: "POST" });
      window.location.href = "/login.html";
    });

    init();
  </script>
</body>
</html>
